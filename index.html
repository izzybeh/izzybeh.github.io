<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"></script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <!-- input number formatter -->
    <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.5.4"></script>
    <title>Wiser Homebuyer</title>

    <style>
        .feature {
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.325rem;
            cursor: pointer;
        }

        .feature.active,
        .feature:hover {
            border-color: #0d6efd;
            color: #0d6efd;
        }

        .feature-container {
            display: none;
        }

        .feature-container.active {
            display: block;
        }


        .card-label {
            font-size: 0.85rem;
            opacity: 0.65;
        }

        .calc-container {
            width: auto;
        }

        .result-container {
            margin-top: 2rem;
            border-top: 1px solid #dee2e6;
            padding-top: 2rem;
        }

        @media (min-width: 576px) {
            .result-container {
                margin-left: 2rem;
                border-left: 1px solid #dee2e6;
                padding-left: 2rem;
                margin-top: 0;
                border-top: none;
                padding-top: 0;
                flex: 1;
            }

            .calc-container {
                width: 351px;
            }
        }
    </style>
</head>

<body class="mb-5">
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Wiser Homebuyer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Features
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li>
                                <a class="dropdown-item" href="calculate-monthly-payment.html">Calculate Monthly
                                    Payment</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="find-purchase-budget.html">Find Purchase Budget</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="compare-home-prices.html">Compare Home Prices</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="p-5 mb-4 bg-light rounded-3">
        <div class="container-fluid py-5 text-center">
            <h1 class="display-1 fw-bold">Wiser Homebuyer</h1>
            <p class="fs-4">
                We listened to the experts and built their advice into our tools. You're welcome.
            </p>
        </div>
    </div>
    <div class="container mt-4">
        <h2>Mortgage Calculators</h2>
        <div class="row justify-content-center text-center mt-4">
            <div class="col-6 col-sm-4">
                <div class="feature active" data-id="#monthly-payment-container">
                    <div class="feature-body">
                        <div class="display-1">
                            <i class="bi bi-currency-dollar"></i>
                        </div>
                        Monthly Payment
                    </div>
                </div>
            </div>
            <div class="col-6 col-sm-4">
                <div class="feature" data-id="#purchase-budget-container">
                    <div class="feature-body">
                        <div class="display-1">
                            <i class="bi bi-bank"></i>
                        </div>
                        Purchase Budget
                    </div>
                </div>
            </div>
            <div class="col-6 col-sm-4">
                <div class="feature" data-id="#compare-homes-container">
                    <div class="feature-body">
                        <div class="display-6">
                            <i class="bi bi-house-fill"></i>
                            <i class="bi bi-house-door"></i>
                        </div>
                        <div class="display-6">
                            <i class="bi bi-house"></i>
                            <i class="bi bi-house-door-fill"></i>
                        </div>
                        Compare Home Prices
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="row mt-4">
            <div class="feature-container active" id="monthly-payment-container">
                <h3 class="mb-4">Calculate Monthly Payment</h3>
                <div class="d-sm-flex flex-wrap">
                    <div class="calc-container">
                        <form action="" id="monthly-payment-form">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control comma" id="home-price" placeholder="$240,000"
                                    required>
                                <label for="home-price">Home Price</label>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="down-payment" placeholder="$48,000"
                                            required>
                                        <label for="down-payment">Down Payment</label>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <div class="mb-3 form-floating">
                                        <input type="text" class="form-control" id="down-payment-percentage"
                                            placeholder="20">
                                        <label for="down-payment-percentage">
                                            % Down</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" aria-label="Select loan-term" id="loan-term"
                                            required>
                                            <option value="360" selected>30-yr fixed</option>
                                            <option value="240">20-yr fixed</option>
                                            <option value="180">15-yr fixed</option>
                                        </select>
                                        <label for="loan-term" class="form-label">Loan Term</label>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <div class="mb-3 form-floating">
                                        <input type="text" class="form-control" id="interest-rate" placeholder="6.015%"
                                            required>
                                        <label for="interest-rate">Interest Rate</label>
                                        <!-- People are likely coming to see what they can expect for an interest rate. We need to calculate this somehow. It looks like the others are calculating based on credit score -->
                                    </div>
                                </div>
                            </div>

                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input taxes-fees" type="checkbox" role="switch"
                                    id="taxes-fees">
                                <label class="form-check-label" for="taxes-fees">Include taxes & fees</label>
                            </div>

                            <div id="taxes-fees-container" class="d-none taxes-fees-container">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="property-tax" placeholder="$4,000">
                                    <label for="property-tax">Property Tax (Yearly)</label>
                                    <!-- 
                                        Store average property tax for states, counties, and cities in db  to calculate this. Or pull from external source 
                                        Property taxes likely change yearly
                                    -->
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="home-insurance" placeholder="$1,050">
                                    <label for="home-insurance">Home Insurance (Yearly)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="mortgage-insurance" placeholder="$0">
                                    <label for="mortgage-insurance">Mortgage Insurance (Monthly)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="hoa" placeholder="$0">
                                    <label for="hoa">Homeowners Association (Monthly)</label>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Calculate Monthly
                                    Payment</button>
                            </div>
                        </form>
                    </div>
                    <div class="result-container">
                        <div class="card mb-3" id="payment-container">
                            <div class="card-body">
                                <div class="card-label">Monthly Payment</div>
                                <div class="display-6">
                                    <span id="payment">$0.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="card mb-3 d-none" id="payment-details-container">
                            <div class="card-body">
                                <div class="card-label">Monthly Payment Breakdown</div>
                                <div class="mt-3" id="payment-details-content">
                                </div>
                            </div>
                        </div>
                        <div class="d-grid gap-2 col-md-6 mx-auto mt-3 d-none" id="amort-btn-container">
                            <button type="button" class="btn btn-link" data-bs-toggle="modal"
                                data-bs-target="#amortModal">
                                View Amortization Schedule
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="feature-container" id="purchase-budget-container">
                <h3>Purchase Budget</h3>
                <div class="d-sm-flex flex-wrap">
                    <div class="calc-container">
                        <form action="" id="purchase-budget-form">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="income" placeholder="$57,000" required>
                                <label for="income">Yearly Income (Pretax)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="debt" placeholder="$0" value="0" required>
                                <label for="debt">Monthly Debt (credit cards, car, etc)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="budget-down" placeholder="$48,000" required>
                                <label for="budget-down">Down Payment</label>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" aria-label="Select budget-loan-term"
                                            id="budget-loan-term" required>
                                            <option value="360" selected>30-yr fixed</option>
                                            <option value="240">20-yr fixed</option>
                                            <option value="180">15-yr fixed</option>
                                        </select>
                                        <label for="budget-loan-term" class="form-label">Loan Term</label>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <div class="mb-3 form-floating">
                                        <input type="text" class="form-control" id="budget-interest-rate"
                                            placeholder="6.015%" required>
                                        <label for="budget-interest-rate">Interest Rate</label>
                                        <!-- People are likely coming to see what they can expect for an interest rate. We need to calculate this somehow. It looks like the others are calculating based on credit score -->
                                    </div>
                                </div>
                            </div>

                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="budget-property-tax" placeholder="$4,000">
                                <label for="budget-property-tax">Property Tax (Yearly)</label>
                                <!-- 
                                    Store average property tax for states, counties, and cities in db to calculate this. Or pull from external source 
                                    Property taxes likely change yearly
                                -->
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="budget-home-insurance" placeholder="$1,050">
                                <label for="budget-home-insurance">Home Insurance (Yearly)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="budget-mortgage-insurance" placeholder="$0"
                                    value="0">
                                <label for="budget-mortgage-insurance">Mortgage Insurance (Monthly)</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="budget-hoa" placeholder="$0">
                                <label for="budget-hoa">Homeowners Association (Monthly)</label>
                            </div>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Calculate Purchase
                                    Budget</button>
                            </div>
                        </form>
                    </div>
                    <div class="result-container">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="card mb-3" id="budget-container">
                                    <div class="card-body">
                                        <div class="card-label">Purchase Budget <i class="bi bi-info-circle"
                                                data-bs-toggle="tooltip"
                                                data-bs-title="Based on a 36% debt-to-income ratio"></i></div>
                                        <div class="display-6">
                                            <span id="budget">$0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="card mb-3" id="mortgage-container">
                                    <div class="card-body">
                                        <div class="card-label">Mortgage Amount <i class="bi bi-info-circle"
                                                data-bs-toggle="tooltip"
                                                data-bs-title="Purchase budget less down payment"></i></div>
                                        <div class="display-6">
                                            <span id="mortgage">$0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-3 d-none" id="budget-payment-details-container">
                            <div class="card-body">
                                <div class="card-label">Monthly Payment Breakdown</div>
                                <div class="mt-3" id="budget-payment-details-content">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="feature-container" id="compare-homes-container">
                <h3>Compare Home Prices</h3>
                <p>Compare a range of home prices to find the your sweet spot</p>
                <!-- 
                    I haven't started shopping around yet. 
                    I don't have time or knowledge to build a spreadsheet
                    I don't know how much is too much
                    I want to find a price that matches my budget
                    I want to know how much is 20% to avoid mortgage insurance
                    How much is mortgage insurance?
                    What other costs should I be aware of?
                    How much can I expect to pay in closing costs? 

                    Does it make sense to start with base salary and show recommendations?
                        - 25% of after-tax salary
                        - 36% debt-to-income
                -->
                <div class="d-sm-flex flex-wrap">
                    <div class="calc-container">
                        <form action="" id="compare-form">
                            <div class="d-flex align-items-center">
                                <div>
                                    <div class="mb-3 form-floating">
                                        <select class="form-select" aria-label="Select periods" id="min" required>
                                            <option selected>Select Min Price</option>
                                            <option value="100000">$100,000</option>
                                            <option value="200000">$200,000</option>
                                            <option value="300000">$300,000</option>
                                            <option value="400000">$400,000</option>
                                            <option value="500000" selected>$500,000</option>
                                            <option value="600000">$600,000</option>
                                            <option value="700000">$700,000</option>
                                            <option value="800000">$800,000</option>
                                            <option value="900000">$900,000</option>
                                            <option value="1000000">$1,000,000</option>
                                            <option value="1100000">$1,100,000</option>
                                            <option value="1200000">$1,200,000</option>
                                            <option value="1300000">$1,300,000</option>
                                        </select>
                                        <label class="form-label" for="min">Min Price</label>
                                    </div>
                                </div>
                                <div class="p-2 mb-3 text-center">
                                    to
                                </div>
                                <div>
                                    <div class="mb-3 form-floating">
                                        <!-- TODO: Disable numbers below min -->
                                        <select class="form-select" aria-label="Select periods" id="max" required>
                                            <option selected>Select Min Price</option>
                                            <option value="100000">$100,000</option>
                                            <option value="200000">$200,000</option>
                                            <option value="300000">$300,000</option>
                                            <option value="400000">$400,000</option>
                                            <option value="500000">$500,000</option>
                                            <option value="600000">$600,000</option>
                                            <option value="700000">$700,000</option>
                                            <option value="800000">$800,000</option>
                                            <option value="900000">$900,000</option>
                                            <option value="1000000" selected>$1,000,000</option>
                                            <option value="1100000">$1,100,000</option>
                                            <option value="1200000">$1,200,000</option>
                                            <option value="1300000">$1,300,000</option>
                                            <option value="1400000">$1,400,000</option>
                                            <option value="1500000">$1,500,000</option>
                                        </select>
                                        <label class="form-label" for="max">Max Price</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="compare-down" placeholder="$48,000"
                                    value="100000" required>
                                <label for="compare-down">Down Payment</label>
                            </div>
                            <div class="row">
                                <div class="col-7">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" aria-label="Select loan-term" id="compare-loan-term"
                                            required>
                                            <option value="360" selected>30-yr fixed</option>
                                            <option value="240">20-yr fixed</option>
                                            <option value="180">15-yr fixed</option>
                                        </select>
                                        <label for="compare-loan-term" class="form-label">Loan Term</label>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <div class="mb-3 form-floating">
                                        <input type="text" class="form-control" id="compare-interest-rate"
                                            placeholder="6.015%" required>
                                        <label for="interest-rate">Interest Rate</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input taxes-fees" type="checkbox" role="switch"
                                    id="compare-taxes-fees">
                                <label class="form-check-label" for="compare-taxes-fees">Include taxes & fees</label>
                            </div>
                            <div id="compare-taxes-fees-container" class="d-none taxes-fees-container">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="compare-property-tax"
                                        placeholder="$4,000">
                                    <label for="compare-property-tax">Property Tax (Yearly)</label>
                                    <!-- 
                                        Store average property tax for states, counties, and cities in db  to calculate this. Or pull from external source 
                                        Property taxes likely change yearly
                                    -->
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="compare-home-insurance"
                                        placeholder="$1,050">
                                    <label for="compare-home-insurance">Home Insurance (Yearly)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="compare-mortgage-insurance"
                                        placeholder="$0" value="0">
                                    <label for="compare-mortgage-insurance">Mortgage Insurance (Monthly)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="compare-hoa" placeholder="$0"
                                        value="132">
                                    <label for="compare-hoa">Homeowners Association (Monthly)</label>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Compare</button>
                            </div>
                        </form>
                    </div>
                    <div class="result-container">
                        <table class="table table-striped-columns table-bordered">
                            <thead id="comp-head" class="text-center table-dark"></thead>
                            <tbody id="comp-body" class="text-end"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="amortModal" tabindex="-1" aria-labelledby="amortModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Amortization Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="card-label">Total Interest Paid</div>
                            <div class="display-6">
                                <span id="total-interest">$0.00</span>
                                <span class="fs-5">
                                    (<span class="text-warning fw-bold" id="perc-loan">0</span> of loan value)
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="amort">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>Beg. Balance</th>
                                    <th>Payment</th>
                                    <th>Interest</th>
                                    <th>Principle</th>
                                    <th>End Balance</th>
                                </tr>
                            </thead>
                            <tbody id="amort-body" class="text-align-end"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" async src="https://cdn.reamaze.com/assets/reamaze.js"></script>
    <script type="text/javascript">
        var _support = _support || { 'ui': {}, 'user': {} };
        _support['account'] = 'wiser-homebuyer';
        _support['ui']['contactMode'] = 'mixed';
        _support['ui']['enableKb'] = 'true';
        _support['ui']['styles'] = {
            widgetColor: 'rgba(16, 162, 197, 1)',
            gradient: true,
        };
        _support['ui']['shoutboxFacesMode'] = 'default';
        _support['ui']['shoutboxHeaderLogo'] = true;
        _support['ui']['widget'] = {
            displayOn: 'all',
            fontSize: 'default',
            allowBotProcessing: true,
            label: {
                text: 'Let us know if you have any questions! &#128522;',
                mode: "notification",
                delay: 3,
                duration: 30,
                primary: "I have a question",
                secondary: "No, thanks",
                sound: true,
            },
            position: 'bottom-right',
            mobilePosition: 'bottom-right'
        };
        _support['apps'] = {
            faq: { "enabled": true },
            recentConversations: {},
            orders: {}
        };
    </script>
</body>
<script>
    // Create our number formatter.
    var formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0, // (causes 2500.99 to be printed as $2,501)
    });

    // Enable tooltips
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))


    $(function () {
        // Add commas to inputs
        AutoNumeric.multiple([
            '#home-price',
            '#down-payment',
            '#home-insurance',
            '#hoa',
            '#property-tax',
            '#mortgage-insurance',
            '#budget-down',
            '#income',
            '#debt',
            '#budget-property-tax',
            '#budget-home-insurance',
            '#budget-mortgage-insurance',
            '#budget-hoa',

            '#compare-home-insurance',
            '#compare-hoa',
            '#compare-property-tax',
            '#compare-mortgage-insurance',
            '#compare-down'
        ], {
            allowDecimalPadding: false,
            decimalPlaces: 0,
            watchExternalChanges: true,
            currencySymbol: '$'
        });

        // Toggle between calculators
        $('.feature').click(function () {
            let id = $(this).data('id');

            $('.feature, .feature-container').removeClass('active');
            $(this).addClass('active');
            $(id).addClass('active');
        });

        // Handle down payemnt calculation
        $('#down-payment').on('keypress keydown change', function () {
            let price = convertToFloat($('#home-price').val().replaceAll(',', '')),
                down = convertToFloat($(this).val().replaceAll(',', '')),
                perc = down > 0 ? ((down / price) * 100).toFixed(0) : 0;

            $('#down-payment-percentage').val(perc);
        });

        // Calculate down as a percentage
        $('#down-payment-percentage').on('change', function () {
            let price = convertToFloat($('#home-price').val().replaceAll(',', '')),
                perc = convertToFloat($(this).val().replaceAll(',', '')),
                down = perc > 0 ? ((perc * price) / 100).toFixed(0) : 0;

            $('#down-payment').val(down);
        });

        // toggle taxes and fees
        $('.taxes-fees').change(function () {
            $taxFeeCont = $(this).closest('form').find('.taxes-fees-container');
            $taxFeeCont.toggleClass('d-none');

            if ($(this).prop('checked') == true) {
                $taxFeeCont.find('input').prop('required', true);
            } else {
                $taxFeeCont.find('input').prop('required', false);
            }
        });

        // Do the calculation 
        $('#monthly-payment-form').submit(function (e) {
            e.preventDefault();
            let amount = (convertToFloat($('#home-price').val()) - convertToFloat($('#down-payment').val())),
                rate = ((convertToFloat($('#interest-rate').val()) / 100) / 12),
                periods = parseInt($('#loan-term').val()),
                tax = (convertToFloat($('#property-tax').val()) / 12),
                hins = (convertToFloat($('#home-insurance').val()) / 12),
                mins = convertToFloat($('#mortgage-insurance').val()),
                hoa = convertToFloat($('#hoa').val()),
                payment = calcPayment(amount, rate, periods),
                amort = createAmort(amount, rate, periods, payment);


            if ($('#taxes-fees').prop('checked') == true) {
                let totals = calcTotalPayment(payment, tax, hins, mins, hoa);
                payment = totals.total;
                $('#payment-details-content').empty().append(totals.totals)
                $('#payment-details-container').removeClass('d-none');
            } else {
                $('#payment-details-container').addClass('d-none');
            }
            $('#payment').text(formatter.format(payment));
            $('#total-interest').text(amort.totalInterest);
            $('#perc-loan').text(amort.percLoan);
            $('#amort-btn-container').removeClass('d-none');
            $('#amort-body').empty().append(amort.schedule);

        });

        // Calculate Purchase Budget
        $('#purchase-budget-form').submit(function (e) {
            e.preventDefault();
            let income = (convertToFloat($('#income').val()) / 12),
                debt = (convertToFloat($('#debt').val())),
                down = (convertToFloat($('#budget-down').val())),
                rate = ((convertToFloat($('#budget-interest-rate').val()) / 100) / 12),
                periods = parseInt($('#budget-loan-term').val()),
                tax = (convertToFloat($('#budget-property-tax').val()) / 12),
                hins = (convertToFloat($('#budget-home-insurance').val()) / 12),
                mins = convertToFloat($('#budget-mortgage-insurance').val()),
                hoa = convertToFloat($('#budget-hoa').val()),
                dir = 0.36,
                maxDebt = (income * dir),
                maxPayment = (maxDebt - debt - tax - hins - mins - hoa),
                mortgage = calcMortgage(rate, periods, maxPayment),
                budget = (mortgage + down),
                totals = calcTotalPayment(maxPayment, tax, hins, mins, hoa);

            $('#budget').text(formatter.format(budget));
            $('#mortgage').text(formatter.format(mortgage));

            $('#budget-payment-details-content').empty().append(totals.totals)
            $('#budget-payment-details-container').removeClass('d-none');
        });

        $('#compare-form').submit(function (e) {
            e.preventDefault();
            let max = convertToFloat($('#max').val()),
                min = convertToFloat($('#min').val()),
                increment = 100000,
                prices = createPrices(min, max, increment),
                down = convertToFloat($('#compare-down').val()),
                rate = convertToFloat($('#compare-interest-rate').val()),
                term = convertToFloat($('#compare-loan-term').val()),
                taxRate = convertToFloat($('#compare-property-tax').val()),
                hIns = convertToFloat($('#compare-home-insurance').val()),
                mIns = convertToFloat($('#compare-mortgage-insurance').val()),
                hoa = convertToFloat($('#compare-hoa').val()),
                comparisons = createComparisons(prices, down, rate, taxRate, term, hIns, hoa),
                $thead = `<tr><td>Price</td>`,
                $tbody = `<tr>`;

            for (price of comparisons.price) {
                $thead += `<td>${formatter.format(price)}</td>`;
            }

            $thead += `</tr>`;
            $tbody += `</tr>`;

            $tbody += `<tr><th class="text-start">Down Payment</th>`;

            for (down of comparisons.down) {
                $tbody += `<td>${formatter.format(down)}</td>`;
            }

            $tbody += `</tr>`;

            $tbody += `<tr><th class="text-start">Mortgage</th>`;

            for (mortgage of comparisons.mortgage) {
                $tbody += `<td>${formatter.format(mortgage)}</td>`;
            }

            $tbody += `</tr>`;
            $tbody += `<tr><th class="text-start">Loan to Value</th>`;

            for (loanToValue of comparisons.loanToValue) {
                $tbody += `<td>${loanToValue}%</td>`;
            }

            $tbody += `</tr>`;
            $tbody += `<tr><th class="text-start">Mortgage Payment</th>`;

            for (pmt of comparisons.pmt) {
                $tbody += `<td>${formatter.format(pmt)}</td>`;
            }

            $tbody += `</tr>`;


            $tbody += `<tr><th class="text-start">Property Tax</th>`;

            for (tPmt of comparisons.tPmt) {
                $tbody += `<td>${formatter.format(tPmt)}</td>`;
            }

            $tbody += `</tr>`;

            $tbody += `<tr><th class="text-start">Home Insurance</th>`;

            for (iPmt of comparisons.iPmt) {
                $tbody += `<td>${formatter.format(iPmt)}</td>`;
            }

            $tbody += `</tr>`;

            $tbody += `<tr><th class="text-start">HOA</th>`;

            for (hPmt of comparisons.hPmt) {
                $tbody += `<td>${formatter.format(hPmt)}</td>`;
            }

            $tbody += `</tr>`;
            $tbody += `<tr class=""><th class="text-start table-group-divider">Total Monthly Payment</th>`;

            for (total of comparisons.total) {
                $tbody += `<td>${formatter.format(total)}</td>`;
            }

            $tbody += `</tr>`;

            $('#comp-head').empty().append($thead);
            $('#comp-body').empty().append($tbody);
            // $('#comp').removeClass('d-none');
            // $('#compare-form').addClass('d-none');

        });

    });

    function convertToFloat(str) {
        console.log(str);
        return parseFloat(str.replaceAll(',', '').replaceAll('$', ''));
    }

    function calcMortgage(rate, periods, payment) {
        return payment / rate * (1 - Math.pow(1 + rate, -periods));
    }

    function calcPayment(amount, rate, periods) {
        let payment = (amount * (rate / (1 - Math.pow(1 + rate, -periods))));
        return payment;
    }

    function calcTotalPayment(payment, tax, hins, mins, hoa) {
        let total = payment + tax + hins + mins + hoa,
            $totals = `
                <div class="d-flex justify-content-between mb-3">
                    <div>Loan</div>
                    <div class="text-end" id="totals-loan">${formatter.format(payment)}</div>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <div>Property Tax</div>
                    <div class="text-end" id="totals-tax">${formatter.format(tax)}</div>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <div>Home Insurance</div>
                    <div class="text-end" id="totals-hins">${formatter.format(hins)}</div>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <div>Mortgage Insurance</div>
                    <div class="text-end" id="totals-mins">${formatter.format(mins)}</div>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <div>Homeowners Association</div>
                    <div class="text-end" id="totals-hoa">${formatter.format(hoa)}</div>
                </div>
                
                <div class="d-flex justify-content-between pt-3 border-top fw-semibold">
                    <div>Total Monthly Payment</div>
                    <div class="text-end" id="totals-total">${formatter.format(total)}</div>
                </div>
            `;

        return {
            total: total,
            totals: $totals
        }
    }

    function createAmort(amount, rate, periods, payment) {
        let totalInterest = 0,
            balance = amount,
            $schedule;

        for (i = 1; i <= periods; i++) {
            let beg = balance,
                interest = (beg * rate),
                principle = payment - interest,
                end = beg - principle;

            balance = end;
            totalInterest += interest;
            $schedule += '<tr>' +
                '<td>' + i + '</td>' +
                '<td>' + formatter.format(beg) + '</td>' +
                '<td>' + formatter.format((principle + interest)) + '</td>' +
                '<td>' + formatter.format(interest) + '</td>' +
                '<td>' + formatter.format(principle) + '</td>' +
                '<td>' + formatter.format(balance) + '</td>'
            '</tr>';
        }

        return {
            totalInterest: formatter.format(totalInterest),
            percLoan: ((totalInterest / amount) * 100).toFixed(0) + `%`,
            schedule: $schedule
        };
    }

    function createPrices(min, max, increment) {
        let c = min, prices = [min];
        while (c < max) {
            c += increment
            prices.push(c);
        }
        if (!prices.indexOf(max)) {
            prices.push(max);
        }
        return prices;
    }

    function createComparisons(prices, down, rate, taxRate, term, insurance, hoa) {
        let comparisons = {},
            iPmt = (insurance / 12),
            hPmt = hoa,
            mRate = ((rate / 100) / 12);

        comparisons.price = [];
        comparisons.down = [];
        comparisons.mortgage = [];
        comparisons.loanToValue = [];
        comparisons.pmt = [];
        comparisons.tPmt = [];
        comparisons.iPmt = [];
        comparisons.hPmt = [];
        comparisons.total = [];
        comparisons.totalPerGross = [];
        comparisons.totalPerNet = [];

        for (price of prices) {
            let mortgage = (price - down),
                loanToValue = ((Math.round((mortgage / price) * 100) / 100) * 100).toFixed(0),
                pmt = calcPayment(mortgage, mRate, term),
                tPmt = (taxRate / 12),
                total = (pmt + tPmt + iPmt + hPmt);

            comparisons.price.push(price);
            comparisons.down.push(down);
            comparisons.mortgage.push(mortgage);
            comparisons.loanToValue.push(loanToValue);
            comparisons.pmt.push(pmt);
            comparisons.tPmt.push(tPmt);
            comparisons.iPmt.push(iPmt);
            comparisons.hPmt.push(hPmt);
            comparisons.total.push(total);
        }

        return comparisons
    }
</script>

</html>